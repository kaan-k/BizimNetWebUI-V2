<div class="dialog-container">
    
    <div class="dialog-header">
        <div class="header-content">
            <h5 class="title">
                <!-- Change Icon based on mode -->
                <i class="fa-solid me-2" [ngClass]="isBranchMode ? 'fa-store' : 'fa-user-plus'"></i>
                {{ isBranchMode ? 'Yeni Şube Ekle' : lang.addNewCustomer }}
            </h5>
        </div>
        <button class="btn-close-white" (click)="close()">
            <i class="fa-solid fa-xmark"></i>
        </button>
    </div>

    <div class="dialog-body custom-scroll">
        <form [formGroup]="customerForm">
            
            <!-- NEW: Parent Company Selection -->
            <div class="row g-3 mb-3">
                <div class="col-12">
                    <label class="form-label">
                        {{ isBranchMode ? 'Bağlı Olduğu Merkez' : 'Bağlı Olduğu Firma (Şube ise)' }}
                    </label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-sitemap input-icon"></i>
                        
                        <!-- Case A: Locked to specific Parent -->
                        <div *ngIf="isBranchMode" class="form-control ps-5 bg-light d-flex align-items-center">
                             <strong>{{ data.parentName || 'Merkez Firma' }}</strong>
                        </div>

                        <!-- Case B: Dropdown Selection -->
                        <select *ngIf="!isBranchMode" class="form-control ps-5" formControlName="parentCustomerId" style="appearance: auto;">
                            <option [ngValue]="null" selected>-- Merkez Yok (Ana Firma) --</option>
                            <option *ngFor="let hq of headquarters" [value]="hq.id">
                                {{ hq.companyName }}
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">
                        {{ isBranchMode ? 'Şube Adı' : lang.customerName }} <span class="text-danger">*</span>
                    </label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-user input-icon"></i>
                        <input type="text" class="form-control ps-5" formControlName="name" 
                               [placeholder]="isBranchMode ? 'Örn: Kadıköy Şubesi' : lang.customerName">
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">
                        {{ lang.companyName }} <span class="text-danger">*</span>
                    </label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-building input-icon"></i>
                        <input type="text" class="form-control ps-5" formControlName="companyName" 
                               [placeholder]="lang.companyName">
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">{{lang.email}}</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-envelope input-icon"></i>
                        <input type="email" class="form-control ps-5" formControlName="email" placeholder="mail@example.com">
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">{{lang.phoneNumber}}</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-phone input-icon"></i>
                        <input type="tel" class="form-control ps-5" formControlName="phoneNumber" placeholder="0555 555 55 55">
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">{{lang.taxid}}</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-file-invoice input-icon"></i>
                        <input type="text" class="form-control ps-5" formControlName="taxid">
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">{{lang.customerFields}}</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-tag input-icon"></i>
                        <input type="text" class="form-control ps-5" formControlName="customerField">
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">{{lang.country}}</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-globe input-icon"></i>
                        <input type="text" class="form-control ps-5" formControlName="country">
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">{{lang.city}}</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-city input-icon"></i>
                        <input type="text" class="form-control ps-5" formControlName="city">
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">{{lang.address}}</label>
                <div class="input-wrapper">
                    <i class="fa-solid fa-map-pin input-icon textarea-icon"></i>
                    <textarea class="form-control ps-5" formControlName="address" rows="2"></textarea>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">{{lang.status}}</label>
                <div class="input-wrapper">
                    <i class="fa-solid fa-toggle-on input-icon"></i>
                    <select class="form-control ps-5" formControlName="status" style="appearance: auto;">
                        <option value="Active">Aktif Müşteri</option>
                        <option value="Potential">Potansiyel Müşteri</option>
                        <option value="Inactive">Pasif Müşteri</option>
                    </select>
                </div>
            </div>

        </form>
    </div>

    <div class="dialog-footer">
        <button class="button-4" (click)="close()">
            {{lang.cancel || 'Vazgeç'}}
        </button>
        
        <button class="button-24" (click)="addCustomer()" [disabled]="customerForm.invalid">
            <i class="fa-solid fa-check me-2"></i> {{ isBranchMode ? 'Şubeyi Kaydet' : lang.addNewCustomer }}
        </button>
    </div>
</div>
<div class="dialog-container">
    
    <div class="dialog-header">
        <div class="header-content">
            <h5 class="title">Görev Detayı</h5>
            <p class="subtitle">ID: #{{ data.id }}</p>
        </div>
        <button class="btn-close-white" (click)="close()">
            <i class="fa-solid fa-xmark"></i>
        </button>
    </div>

    <div class="dialog-body custom-scroll">
        
        <div class="status-card mb-4">
            <div class="row g-0 text-center">
                
                <div class="col-4 border-end">
                    <span class="label">Durum</span>
                    <div class="value" [class.text-success]="data.status === 'Tamamlandı'" [class.text-danger]="data.status !== 'Tamamlandı'">
                        <i class="fa-solid" [class.fa-check-circle]="data.status === 'Tamamlandı'" [class.fa-clock]="data.status !== 'Tamamlandı'"></i>
                        {{ data.status }}
                    </div>
                </div>

                <div class="col-4 border-end">
                    <span class="label">Öncelik</span>
                    <div class="value fw-bold">{{ data.priority }}</div>
                </div>

                <div class="col-4">
                    <span class="label">
                        {{ data.status === 'Tamamlandı' ? 'Tamamlanma' : 'Başlangıç' }}
                    </span>
                    <div class="value font-monospace">
                        {{ (data.status === 'Tamamlandı' ? data.completedAt : data.beginsAt) | date:'dd.MM.yy HH:mm' }}
                    </div>
                </div>
            </div>
        </div>

        <form>
            <div class="form-group mb-3">
                <label class="form-label">Görev Başlığı</label>
                <div class="input-wrapper">
                    <i class="fa-solid fa-heading input-icon"></i>
                    <input type="text" class="form-control read-only ps-5" [value]="data.name" readonly>
                </div>
            </div>

            <div class="form-group mb-3">
                <label class="form-label">Açıklama</label>
                <div class="input-wrapper">
                    <textarea class="form-control read-only" rows="3" readonly>{{ data.description || 'Açıklama yok.' }}</textarea>
                </div>
            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">Müşteri</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-building input-icon"></i>
                        <input type="text" class="form-control read-only ps-5" [value]="data.customerId" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Personel</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-user-tie input-icon"></i>
                        <input type="text" class="form-control read-only ps-5" [value]="data.assignedEmployeeId" readonly>
                    </div>
                </div>
            </div>

            <!-- <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">Başlangıç Zamanı</label>
                    <div class="input-wrapper">
                        <i class="fa-regular fa-calendar input-icon"></i>
                        <input type="text" class="form-control read-only ps-5" [value]="data.beginsAt | date:'dd MMMM yyyy HH:mm'" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">
                        {{ data.status === 'Tamamlandı' ? 'Tamamlanma Zamanı' : 'Planlanan Bitiş' }}
                    </label>
                    <div class="input-wrapper">
                        <i class="fa-regular fa-clock input-icon" [class.text-success]="data.status === 'Tamamlandı'"></i>
                        <input type="text" class="form-control read-only ps-5" 
                               [class.text-success]="data.status === 'Tamamlandı'"
                               [value]="(data.status === 'Tamamlandı' ? data.completedAt : data.endsAt) | date:'dd MMMM yyyy HH:mm'" 
                               readonly 
                               placeholder="-">
                    </div>
                </div>
            </div> -->

            <div class="signature-box mt-4" *ngIf="data.signatureBase64">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label mb-0 text-primary">
                        <i class="fa-solid fa-signature"></i> Yetkili İmzası
                    </label>
                    <button type="button" class="btn btn-sm btn-outline-secondary" (click)="toggleImage()">
                        {{ showImage ? 'Gizle' : 'Görüntüle' }}
                    </button>
                </div>

                <div class="signature-viewer" *ngIf="showImage">
                    <img [src]="data.signatureBase64" class="img-fluid" alt="İmza">
                    <div class="signature-footer">
                        <a [href]="data.signatureBase64" download="imza.png" class="btn btn-sm btn-light border">
                            <i class="fa-solid fa-download"></i> İndir
                        </a>
                    </div>
                </div>
            </div>

        </form>
    </div>

    <div class="dialog-footer">
        <button class="btn btn-light border" (click)="close()">Kapat</button>
        
        <button *ngIf="data.status !== 'Tamamlandı'" 
                class="btn btn-dark-teal" 
                (click)="markAsCompleted(data.id)">
            <i class="fa-solid fa-check-double me-2"></i> Tamamla
        </button>
    </div>
</div>
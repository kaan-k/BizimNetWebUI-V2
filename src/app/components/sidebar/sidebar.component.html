<!-- MOBILE HAMBURGER -->
<button class="mobile-menu-button" (click)="toggleMobileMenu()" aria-label="Menüyü aç">
    <i class="fa-solid fa-bars"></i>
</button>

<nav class="hk-nav" [class.mobile-open]="isMobileMenuOpen">
    <div class="nav-header-wrapper">
        <div class="brand-logo">
            <div class="logo-icon"><i class="fa-solid fa-cubes-stacked"></i></div>
            <span class="brand-text">Ary Yazılım</span>
        </div>
    </div>
    
    <div class="nicescroll-bar custom-scrollbar">
        <div class="navbar-nav-wrap">
            <span class="menu-header">Menü</span>
            
            <ul class="navbar-nav flex-column">
                @for (item of menuItems; track item.label) {
                <li class="nav-item">
                    
                    <!-- CASE 1: Standard Link (No Children) -->
                    @if (!item.children) {
                        <a class="nav-link" [routerLink]="[item.link]" routerLinkActive="active"
                           [routerLinkActiveOptions]="{exact: item.link === '/'}" (click)="closeMobileMenu()">
                            <span class="feather-icon"><i [class]="item.icon"></i></span>
                            <span class="nav-link-text">{{ item.label }}</span>
                            <div class="hover-effect"></div>
                        </a>
                    }
                    
                    <!-- CASE 2: Parent Item (Has Children) -->
                    @if (item.children) {
                        <a class="nav-link has-dropdown" 
                           [class.active]="isParentActive(item)"
                           [class.expanded]="item.expanded"
                           (click)="toggleSubMenu(item)">
                            <div class="d-flex align-items-center flex-grow-1">
                                <span class="feather-icon"><i [class]="item.icon"></i></span>
                                <span class="nav-link-text">{{ item.label }}</span>
                            </div>
                            <!-- Arrow Icon rotates based on expansion -->
                            <i class="fa-solid fa-chevron-right arrow-icon"></i>
                        </a>

                        <!-- Sub Menu -->
                        <div class="sub-menu-wrapper" [class.show]="item.expanded">
                            <ul class="sub-menu">
                                @for (child of item.children; track child.link) {
                                    <li>
                                        <a class="sub-link" [routerLink]="[child.link]" routerLinkActive="active" (click)="closeMobileMenu()">
                                            <i class="fa-solid fa-circle-dot dot-icon"></i>
                                            {{ child.label }}
                                        </a>
                                    </li>
                                }
                            </ul>
                        </div>
                    }

                </li>
                }
            </ul>
        </div>
    </div>
    
    <div class="nav-footer">
        <div class="user-mini">
            <img [src]="'https://ui-avatars.com/api/?name=' + (userName || 'User') + '&background=203b46&color=fff&size=128&bold=true'"
                class="avatar-circle" alt="User Avatar">
            <div class="user-info">
                <span class="name">{{ userName }}</span>
                <span class="role">{{ userRoleText }}</span>
            </div>
            <button class="btn-logout ms-auto" (click)="Logout()" title="Çıkış Yap">
                <i class="fa-solid fa-right-from-bracket"></i>
            </button>
        </div>
    </div>
</nav>

<!-- Mobile Overlay (Optional UX improvement) -->
<div *ngIf="isMobileMenuOpen" class="mobile-overlay" (click)="closeMobileMenu()"></div>